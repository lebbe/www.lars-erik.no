---
interface Props {
  label: string
  columns?: 1 | 2 | 3
  as?: 'section' | 'header' | 'footer'
  class?: string
  heading?: string
  headingLevel?: 'h1' | 'h2' | 'h3' | 'h4' | 'h5' | 'h6'
}

const {
  label,
  columns = 1,
  as: Element = 'section',
  class: className = '',
  heading,
  headingLevel = 'h2',
} = Astro.props

const HeadingTag = headingLevel
---

<Element
  class:list={['editable-section', className]}
  style={`--columns: ${columns}`}
>
  <span class="section-label">{label}</span>
  {heading && <HeadingTag>{heading}</HeadingTag>}
  <div class="editable-content">
    <slot />
  </div>
</Element>

<style>
  .editable-section {
    position: relative;
    padding: 12px 25px;
    background-color: var(--section-bg);
    border: 1px dashed var(--border-color);
    transition: background-color 0.2s ease;
    grid-column: span var(--columns, 1);
  }

  .editable-section:hover {
    background-color: var(--section-hover-bg);
    border: 1px solid transparent;
    background-image:
      linear-gradient(90deg, var(--active-border-color) 50%, transparent 50%),
      linear-gradient(90deg, var(--active-border-color) 50%, transparent 50%),
      linear-gradient(0deg, var(--active-border-color) 50%, transparent 50%),
      linear-gradient(0deg, var(--active-border-color) 50%, transparent 50%);
    background-repeat: repeat-x, repeat-x, repeat-y, repeat-y;
    background-size:
      12px 1px,
      12px 1px,
      1px 12px,
      1px 12px;
    background-position:
      0 0,
      100% 100%,
      0 100%,
      100% 0;
    animation: border-dance 0.7s infinite linear;
  }

  @keyframes border-dance {
    0% {
      background-position:
        0 0,
        100% 100%,
        0 100%,
        100% 0;
    }
    100% {
      background-position:
        12px 0,
        calc(100% - 12px) 100%,
        0 calc(100% - 12px),
        100% 12px;
    }
  }

  .section-label {
    position: absolute;
    top: -10px;
    left: 10px;
    background: var(--bg-color);
    padding: 2px 6px;
    font-size: 0.65rem;
    color: var(--label-color);
    z-index: 10;
  }

  .editable-content {
    outline: none;
  }

  .editable-section.edit-mode-active {
    background-color: var(--section-bg);
    border: 1px solid var(--active-border-color);
    box-shadow: inset 0 0 8px rgba(0, 255, 65, 0.1);
  }

  .editable-section.edit-mode-active .editable-content {
    cursor: text;
  }

  .editable-section.edit-mode-active .editable-content:focus {
    outline: 1px solid var(--active-border-color);
    outline-offset: -2px;
    background-color: rgba(0, 255, 65, 0.05);
  }

  @media (max-width: 768px) {
    .editable-section {
      grid-column: span 1 !important;
      grid-row: auto !important;
    }

    .section-label {
      font-size: 0.6rem;
    }
  }
</style>
